import { useState, useEffect } from "react";
import { useSearchParams, useNavigate } from "react-router-dom";
import { API_BASE_URL } from "../data/api";
import {
  BarChart,
  Bar,
  PieChart,
  Pie,
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  Cell,
  RadarChart,
  Radar,
  PolarGrid,
  PolarAngleAxis,
  PolarRadiusAxis,
  AreaChart,
  Area
} from "recharts";

export default function Gitpluse() {
  const [searchParams] = useSearchParams();
  const navigate = useNavigate();
  const [githubData, setGithubData] = useState(null);
  const [repos, setRepos] = useState([]);
  const [languages, setLanguages] = useState({});
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [authenticated, setAuthenticated] = useState(false);
  const [repoStats, setRepoStats] = useState([]);
  const [contributionData, setContributionData] = useState([]);
  const [repoTypes, setRepoTypes] = useState([]);
  const [advancedStats, setAdvancedStats] = useState({
    avgStarsPerRepo: 0,
    avgForksPerRepo: 0,
    totalWatchers: 0,
    totalOpenIssues: 0,
  });
  const [activityStats, setActivityStats] = useState({
    commits: 0,
    prs: 0,
    issues: 0,
    reviews: 0,
  });

  useEffect(() => {
    const token = searchParams.get("token");
    const githubUsername = searchParams.get("githubUsername");
    const commits = parseInt(searchParams.get("commits")) || 0;
    const prs = parseInt(searchParams.get("prs")) || 0;
    const issues = parseInt(searchParams.get("issues")) || 0;
    const reviews = parseInt(searchParams.get("reviews")) || 0;
    const errorParam = searchParams.get("error");

    console.log("URL Params received:", { token, githubUsername, commits, prs, issues, reviews });

    if (errorParam) {
      setError(`OAuth Error: ${errorParam}`);
    }

    if (token && githubUsername) {
      localStorage.setItem("token", token);
      localStorage.setItem("githubUsername", githubUsername);
      localStorage.setItem("commits", commits);
      localStorage.setItem("prs", prs);
      localStorage.setItem("issues", issues);
      localStorage.setItem("reviews", reviews);
      setAuthenticated(true);
      setActivityStats({ commits, prs, issues, reviews });
      console.log("Activity Stats Set:", { commits, prs, issues, reviews });
      window.history.replaceState({}, document.title, "/gitpluse");
      fetchGithubData(githubUsername);
      fetchStoredGithubData(token);
    } else {
      // Load from localStorage if available
      const storedToken = localStorage.getItem("token");
      const storedUsername = localStorage.getItem("githubUsername");
      const storedCommits = parseInt(localStorage.getItem("commits")) || 0;
      const storedPrs = parseInt(localStorage.getItem("prs")) || 0;
      const storedIssues = parseInt(localStorage.getItem("issues")) || 0;
      const storedReviews = parseInt(localStorage.getItem("reviews")) || 0;

      console.log("Loaded from localStorage:", { storedToken, storedUsername, storedCommits, storedPrs, storedIssues, storedReviews });

      if (storedToken && storedUsername) {
        setAuthenticated(true);
        setActivityStats({ commits: storedCommits, prs: storedPrs, issues: storedIssues, reviews: storedReviews });
        console.log("Activity Stats Loaded from Storage:", { commits: storedCommits, prs: storedPrs, issues: storedIssues, reviews: storedReviews });
        fetchGithubData(storedUsername);
        fetchStoredGithubData(storedToken);
      }
    }
  }, [searchParams]);

  // Fetch stored GitHub data from backend
  const fetchStoredGithubData = async (token) => {
    try {
      const response = await fetch(`${API_BASE_URL}/auth/github-data`, {
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        },
      });

      if (response.ok) {
        const data = await response.json();
        console.log("Stored GitHub Data:", data);
        
        // Update states with stored data
        if (data.profile) {
          setGithubData(prev => ({ ...prev, ...data.profile }));
        }
        if (data.repositories) {
          // You can use this data for enhanced visualizations
          console.log("Stored repositories:", data.repositories);
        }
      } else {
        console.log("Could not fetch stored GitHub data:", response.status);
      }
    } catch (error) {
      console.log("Error fetching stored GitHub data:", error);
    }
  };

  const fetchGithubData = async (username) => {
    try {
      setLoading(true);

      // Fetch user profile
      const userRes = await fetch(`https://api.github.com/users/${username}`);
      const userData = await userRes.json();
      setGithubData(userData);

      // Fetch repositories
      const reposRes = await fetch(
        `https://api.github.com/users/${username}/repos?sort=stars&per_page=100`
      );
      const reposData = await reposRes.json();
      setRepos(reposData);

      // Analyze languages
      const langMap = {};
      for (const repo of reposData.slice(0, 50)) {
        if (repo.language) {
          langMap[repo.language] = (langMap[repo.language] || 0) + 1;
        }
      }
      setLanguages(langMap);

      // Create repository stats data for chart (top 10 repos by stars)
      const statsData = reposData
        .slice(0, 10)
        .map((repo) => ({
          name: repo.name.substring(0, 15),
          stars: repo.stargazers_count,
          forks: repo.forks_count,
        }));
      setRepoStats(statsData);

      // Create contribution data (simulated monthly trend)
      const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun"];
      const contribData = months.map((month, idx) => ({
        month,
        contributions: Math.floor(Math.random() * 500) + 100 + idx * 30,
        prs: Math.floor(Math.random() * 50) + 10,
      }));
      setContributionData(contribData);

      // Categorize repositories by type
      const forked = reposData.filter((r) => r.fork).length;
      const original = reposData.filter((r) => !r.fork).length;
      const repoTypeData = [
        { name: "Original", value: original },
        { name: "Forked", value: forked },
      ];
      setRepoTypes(repoTypeData);

      // Calculate advanced statistics
      const totalStars = reposData.reduce(
        (sum, repo) => sum + (repo.stargazers_count || 0),
        0
      );
      const totalForks = reposData.reduce(
        (sum, repo) => sum + (repo.forks_count || 0),
        0
      );
      const totalWatchers = reposData.reduce(
        (sum, repo) => sum + (repo.watchers_count || 0),
        0
      );
      const totalOpenIssues = reposData.reduce(
        (sum, repo) => sum + (repo.open_issues_count || 0),
        0
      );

      setAdvancedStats({
        avgStarsPerRepo:
          reposData.length > 0 ? Math.round(totalStars / reposData.length) : 0,
        avgForksPerRepo:
          reposData.length > 0 ? Math.round(totalForks / reposData.length) : 0,
        totalWatchers,
        totalOpenIssues,
      });
    } catch (err) {
      console.error("Error fetching GitHub data:", err);
      setError("Failed to fetch GitHub data");
    } finally {
      setLoading(false);
    }
  };

  const handleGitHubLogin = async () => {
    try {
      setLoading(true);
      setError("");

      const response = await fetch(`${API_BASE_URL}/auth/github`);
      const data = await response.json();

      if (data.authUrl) {
        window.location.href = data.authUrl;
      }
    } catch (err) {
      setError("Failed to initiate GitHub login");
    } finally {
      setLoading(false);
    }
  };

  const handleDisconnect = () => {
    localStorage.removeItem("token");
    localStorage.removeItem("githubUsername");
    localStorage.removeItem("commits");
    localStorage.removeItem("prs");
    localStorage.removeItem("issues");
    localStorage.removeItem("reviews");
    setAuthenticated(false);
    setGithubData(null);
    setRepos([]);
    setLanguages({});
    setActivityStats({ commits: 0, prs: 0, issues: 0, reviews: 0 });
    setError("");
  };

  const totalStars = repos.reduce((sum, repo) => sum + (repo.stargazers_count || 0), 0);
  const totalForks = repos.reduce((sum, repo) => sum + (repo.forks_count || 0), 0);
  const topLanguages = Object.entries(languages)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 5);

  const COLORS = [
    "#3b82f6", "#8b5cf6", "#ec4899", "#f59e0b", "#10b981",
    "#06b6d4", "#f472b6", "#a855f7", "#64748b", "#6366f1",
  ];

  return (
    <div className="min-h-screen bg-black text-white overflow-hidden">
      {/* Background decorative elements */}
      <div className="fixed inset-0 overflow-hidden pointer-events-none">
        <div className="absolute top-0 left-1/2 transform -translate-x-1/2 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl"></div>
        <div className="absolute bottom-1/4 right-0 w-96 h-96 bg-purple-500/5 rounded-full blur-3xl"></div>
      </div>

      <div className="relative z-10 min-h-screen flex flex-col">
        {/* Header */}
        <header className="border-b border-gray-800/50 backdrop-blur-md sticky top-0 z-20">
          <div className="max-w-7xl mx-auto px-8 py-6 flex justify-between items-center">
            <div className="flex items-center gap-3">
              <div className="flex items-center gap-2">
                <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center animate-pulse-slow">
                  <svg className="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v 3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                  </svg>
                </div>
                <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent tracking-tight animate-gradient-x">
                  GitPulse
                </h1>
                <span className="ml-4 px-3 py-1 text-xs font-semibold text-gray-300 bg-gradient-to-r from-blue-600/30 to-purple-600/30 border border-blue-500/30 rounded-full animate-pulse-slow">
                  Professional Developer Insights
                </span>
              </div>
            </div>
            {authenticated && (
              <Link 
                to="/gitpulsepro" 
                className="text-gray-400 hover:text-white transition-colors text-sm font-medium"
              >
                Upgrade to Pro
              </Link>
            )}
            {authenticated && (
              <button
                onClick={handleDisconnect}
                className="text-gray-400 hover:text-white transition-colors text-sm font-medium"
              >
                Sign Out
              </button>
            )}
          </div>
        </header>

        {!authenticated ? (
          // Login Section - Hero
          <div className="flex-1 flex items-center justify-center px-4 py-20">
            <div className="max-w-2xl w-full text-center">
              <div className="mb-8">
                <h2 className="text-6xl font-bold mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                  The Pulse of your Codebase
                </h2>
                <p className="text-xl text-gray-400 mb-8">
                  Visualize, analyze, and optimize your development workflow
                </p>
              </div>

              {error && (
                <div className="mb-6 p-4 bg-red-900/20 border border-red-800 rounded-lg">
                  <p className="text-red-400">{error}</p>
                </div>
              )}

              <button
                onClick={handleGitHubLogin}
                disabled={loading}
                className="w-full bg-white hover:bg-gray-100 text-black py-4 px-6 rounded-lg font-semibold transition-all shadow-xl hover:shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 mb-6"
              >
                {loading ? (
                  <>
                    <svg className="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                    </svg>
                    Connecting to GitHub...
                  </>
                ) : (
                  <>
                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v 3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                    </svg>
                    Sign in with GitHub
                  </>
                )}
              </button>

              <p className="text-sm text-gray-500">
                Secure Access • Read-only Permissions • Open Source
              </p>
            </div>
          </div>
        ) : (
          // Dashboard - Full Screen
          <div className="flex-1 px-8 py-12">
            {/* Profile Section */}
            <div className="mb-8">
              <div className="bg-gradient-to-br from-gray-800/50 to-gray-900/50 border border-gray-700 rounded-2xl p-8 backdrop-blur">
                <div className="flex flex-col md:flex-row gap-8 items-start">
                  {githubData?.avatar_url && (
                    <img
                      src={githubData.avatar_url}
                      alt={githubData.login}
                      className="w-32 h-32 rounded-full border-4 border-blue-500 shadow-xl"
                    />
                  )}

                  <div className="flex-1">
                    <h2 className="text-4xl font-bold mb-2">
                      {githubData?.name || githubData?.login}
                    </h2>
                    <p className="text-lg text-blue-400 mb-4">
                      @{githubData?.login}
                    </p>
                    {githubData?.bio && (
                      <p className="text-gray-300 mb-4">{githubData.bio}</p>
                    )}

                    <div className="flex gap-4 flex-wrap mb-6">
                      {githubData?.location && (
                        <div className="flex items-center gap-2 text-gray-400 text-sm">
                          <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clipRule="evenodd" />
                          </svg>
                          {githubData.location}
                        </div>
                      )}
                      {githubData?.company && (
                        <div className="flex items-center gap-2 text-gray-400 text-sm">
                          <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3.5a1 1 0 01-1-1v-2a1 1 0 10-2 0v2a1 1 0 01-1 1H4a1 1 0 110-2V4z" />
                          </svg>
                          {githubData.company}
                        </div>
                      )}
                    </div>
                  </div>

                  <button
                    onClick={handleDisconnect}
                    className="bg-red-900/30 hover:bg-red-900/50 text-red-400 py-2 px-4 rounded-lg border border-red-800 transition-colors whitespace-nowrap"
                  >
                    Disconnect
                  </button>
                </div>
              </div>
            </div>

            {/* Activity Stats - Commits, PRs, Issues, Reviews */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
              <div className="bg-gradient-to-br from-blue-900/20 to-blue-800/10 border border-blue-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Commits</p>
                <p className="text-3xl font-bold text-blue-400">{activityStats.commits || 0}</p>
              </div>
              <div className="bg-gradient-to-br from-purple-900/20 to-purple-800/10 border border-purple-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Pull Requests</p>
                <p className="text-3xl font-bold text-purple-400">{activityStats.prs || 0}</p>
              </div>
              <div className="bg-gradient-to-br from-pink-900/20 to-pink-800/10 border border-pink-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Issues</p>
                <p className="text-3xl font-bold text-pink-400">{activityStats.issues || 0}</p>
              </div>
              <div className="bg-gradient-to-br from-emerald-900/20 to-emerald-800/10 border border-emerald-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Reviews</p>
                <p className="text-3xl font-bold text-emerald-400">{activityStats.reviews || 0}</p>
              </div>
            </div>

            {/* Key Stats */}
            <div className="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
              <div className="bg-gradient-to-br from-blue-900/20 to-blue-800/10 border border-blue-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Repositories</p>
                <p className="text-3xl font-bold text-blue-400">{githubData?.public_repos || 0}</p>
              </div>
              <div className="bg-gradient-to-br from-purple-900/20 to-purple-800/10 border border-purple-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Total Stars</p>
                <p className="text-3xl font-bold text-purple-400">{totalStars}</p>
              </div>
              <div className="bg-gradient-to-br from-pink-900/20 to-pink-800/10 border border-pink-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Total Forks</p>
                <p className="text-3xl font-bold text-pink-400">{totalForks}</p>
              </div>
              <div className="bg-gradient-to-br from-green-900/20 to-green-800/10 border border-green-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Followers</p>
                <p className="text-3xl font-bold text-green-400">{githubData?.followers || 0}</p>
              </div>
              <div className="bg-gradient-to-br from-yellow-900/20 to-yellow-800/10 border border-yellow-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Following</p>
                <p className="text-3xl font-bold text-yellow-400">{githubData?.following || 0}</p>
              </div>
            </div>

            {/* Charts Row 1 */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
              {/* Contributions Trend */}
              <div className="bg-gradient-to-br from-gray-800/50 to-gray-900/50 border border-gray-700 rounded-2xl p-6 backdrop-blur">
                <h3 className="text-2xl font-bold mb-4">Contribution Trend</h3>
                <ResponsiveContainer width="100%" height={400}>
                  <LineChart data={contributionData}>
                    <CartesianGrid strokeDasharray="3 3" stroke="rgba(255,255,255,0.1)" />
                    <XAxis dataKey="month" stroke="rgba(255,255,255,0.5)" />
                    <YAxis stroke="rgba(255,255,255,0.5)" />
                    <Tooltip
                      contentStyle={{
                        backgroundColor: "rgba(15,23,42,0.95)",
                        border: "1px solid rgba(100,116,139,0.5)",
                        borderRadius: "8px",
                      }}
                      labelStyle={{ color: "white" }}
                    />
                    <Legend />
                    <Line
                      type="monotone"
                      dataKey="contributions"
                      stroke="#3b82f6"
                      name="Contributions"
                      strokeWidth={2}
                      dot={{ fill: "#3b82f6", r: 4 }}
                    />
                  </LineChart>
                </ResponsiveContainer>
              </div>

              {/* Repository Type Distribution */}
              {repoTypes.length > 0 && (
                <div className="bg-gradient-to-br from-gray-800/50 to-gray-900/50 border border-gray-700 rounded-2xl p-6 backdrop-blur">
                  <h3 className="text-2xl font-bold mb-4">Repository Types</h3>
                  <ResponsiveContainer width="100%" height={400}>
                    <PieChart>
                      <Pie
                        data={repoTypes}
                        cx="50%"
                        cy="50%"
                        labelLine={false}
                        label={({ name, value }) => `${name}: ${value}`}
                        outerRadius={100}
                        fill="#8884d8"
                        dataKey="value"
                      >
                        {repoTypes.map((entry, index) => (
                          <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                        ))}
                      </Pie>
                      <Tooltip
                        contentStyle={{
                          backgroundColor: "rgba(15,23,42,0.95)",
                          border: "1px solid rgba(100,116,139,0.5)",
                          borderRadius: "8px",
                        }}
                        labelStyle={{ color: "white" }}
                      />
                    </PieChart>
                  </ResponsiveContainer>
                </div>
              )}
            </div>

            {/* Charts Row 2 */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
              {/* Top Repositories Stats */}
              {repoStats.length > 0 && (
                <div className="bg-gradient-to-br from-gray-800/50 to-gray-900/50 border border-gray-700 rounded-2xl p-6 backdrop-blur">
                  <h3 className="text-2xl font-bold mb-4">Top Repositories</h3>
                  <ResponsiveContainer width="100%" height={400}>
                    <BarChart data={repoStats}>
                      <CartesianGrid strokeDasharray="3 3" stroke="rgba(255,255,255,0.1)" />
                      <XAxis dataKey="name" stroke="rgba(255,255,255,0.5)" angle={-45} textAnchor="end" height={80} />
                      <YAxis stroke="rgba(255,255,255,0.5)" />
                      <Tooltip
                        contentStyle={{
                          backgroundColor: "rgba(15,23,42,0.95)",
                          border: "1px solid rgba(100,116,139,0.5)",
                          borderRadius: "8px",
                        }}
                        labelStyle={{ color: "white" }}
                      />
                      <Legend />
                      <Bar dataKey="stars" fill="#3b82f6" name="Stars" />
                      <Bar dataKey="forks" fill="#8b5cf6" name="Forks" />
                    </BarChart>
                  </ResponsiveContainer>
                </div>
              )}

              {/* Language Distribution - Full Width */}
              {Object.keys(languages).length > 0 && (
                <div className="bg-gradient-to-br from-gray-800/50 to-gray-900/50 border border-gray-700 rounded-2xl p-6 backdrop-blur">
                  <h3 className="text-2xl font-bold mb-4">Languages Used</h3>
                  <ResponsiveContainer width="100%" height={400}>
                    <PieChart>
                      <Pie
                        data={Object.entries(languages).map(([lang, count]) => ({
                          name: lang,
                          value: count,
                        }))}
                        cx="50%"
                        cy="50%"
                        labelLine={true}
                        label={({ name, percent }) =>
                          `${name} ${(percent * 100).toFixed(0)}%`
                        }
                        outerRadius={100}
                        fill="#8884d8"
                        dataKey="value"
                      >
                        {Object.entries(languages).map((entry, index) => (
                          <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                        ))}
                      </Pie>
                      <Tooltip
                        contentStyle={{
                          backgroundColor: "rgba(15,23,42,0.95)",
                          border: "1px solid rgba(100,116,139,0.5)",
                          borderRadius: "8px",
                        }}
                        labelStyle={{ color: "white" }}
                      />
                    </PieChart>
                  </ResponsiveContainer>
                </div>
              )}
            </div>

            {/* Advanced Statistics Grid */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
              <div className="bg-gradient-to-br from-indigo-900/20 to-indigo-800/10 border border-indigo-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Avg Stars/Repo</p>
                <p className="text-2xl font-bold text-indigo-400">{advancedStats.avgStarsPerRepo}</p>
              </div>
              <div className="bg-gradient-to-br from-cyan-900/20 to-cyan-800/10 border border-cyan-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Avg Forks/Repo</p>
                <p className="text-2xl font-bold text-cyan-400">{advancedStats.avgForksPerRepo}</p>
              </div>
              <div className="bg-gradient-to-br from-orange-900/20 to-orange-800/10 border border-orange-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Total Watchers</p>
                <p className="text-2xl font-bold text-orange-400">{advancedStats.totalWatchers}</p>
              </div>
              <div className="bg-gradient-to-br from-rose-900/20 to-rose-800/10 border border-rose-700/30 rounded-xl p-6">
                <p className="text-gray-400 text-xs mb-2 uppercase">Open Issues</p>
                <p className="text-2xl font-bold text-rose-400">{advancedStats.totalOpenIssues}</p>
              </div>
            </div>

            {/* Featured Repositories */}
            {repos.length > 0 && (
              <div>
                <h3 className="text-3xl font-bold mb-6">Featured Repositories</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                  {repos.slice(0, 12).map((repo) => (
                    <a
                      key={repo.id}
                      href={repo.html_url}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="bg-gradient-to-br from-gray-800/50 to-gray-900/50 border border-gray-700 rounded-xl p-5 hover:border-blue-500/50 transition-all group cursor-pointer"
                    >
                      <div className="flex items-start justify-between mb-3">
                        <h4 className="text-lg font-semibold group-hover:text-blue-400 transition-colors flex-1 break-words">
                          {repo.name}
                        </h4>
                      </div>

                      {repo.description && (
                        <p className="text-gray-400 text-sm mb-3 line-clamp-2">
                          {repo.description}
                        </p>
                      )}

                      <div className="flex items-center gap-3 text-xs text-gray-400 flex-wrap">
                        {repo.language && (
                          <div className="flex items-center gap-1">
                            <span className="w-2 h-2 bg-blue-500 rounded-full"></span>
                            <span className="text-xs">{repo.language}</span>
                          </div>
                        )}
                        <div className="flex items-center gap-1">
                          <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                          </svg>
                          {repo.stargazers_count}
                        </div>
                        <div className="flex items-center gap-1">
                          <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 5a1 1 0 100 2h5.586l-1.293 1.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 00-1.414 1.414L13.586 5H8z" />
                          </svg>
                          {repo.forks_count}
                        </div>
                      </div>
                    </a>
                  ))}
                </div>
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
}
